
let table = document.getElementById("Body_Structure");
let table2 = document.getElementById("Body_Structure_Search");
let nombreproducto = document.getElementById("Nombre_producto");
let Counter = document.getElementById("Counter");
let APIURL = 'http://192.168.1.12:8080/StockProducto/200';
let APIURL2 = `http://192.168.1.12:8080/StokProductobyroduct/caballa`;
let URI3 = `http://192.168.1.12:8080/GetCuentas`;
let Allnameroducts = 'http://192.168.1.12:8080/AllProducts';
let paramsbusqueda = document.getElementById("SelectProducts");
let CONFIGAPI = {
    method:'Get',
    headers:{
        "Access-Control-Allow-Origin":"*"
    }
}
       
let Filtros = document.getElementById("Filtros");
async function TableAutogenerated(Tabla, TablaId, nombre) {
        Tabla.innerHTML += ` <div class="Contenido3_Tabla_Content">
        <div class="Header_Product">
            <div>
                <div>
                    <label class="form-check-label" for="inlineCheckbox1">Total de Cajas : <strong  id="Cajas${TablaId}"></strong> </label>
                    <br>
                    <label class="form-check-label" for="inlineCheckbox1">Unidades Disponibles : <strong id="Saldo${TablaId}"></strong> </label>
              </div>
            </div>
             <h5>${nombre}</h5>
        </div>
        <div class="Contenidos3_Tabla">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th scope="col">NUM_GUIA</th>
                    <th scope="col">PRODUCTO</th>
                    <th scope="col">UNIDADES</th>
                    <th scope="col">UNID_DESPACHADAS</th>
                    <th scope="col">SALDO</th>
                    <th scope="col">CAJAS</th>
                    <th scope="col">FECHA_GUIA</th>
                    <th scope="col">OBSERVACIONES_GUIA</th>
                    <th scope="col">OBSERVACIONES</th>
                    <th scope="col">NUMERO</th>
                    <th scope="col">CODIGOERP</th>
                    <th scope="col">CODIGO</th>
                    <th scope="col">NOMBRE_DOC</th>
                    <th scope="col">NOMBRE_ESPECIE</th>
                    <th scope="col">FECHA_PRODUCCION</th>
                    <th scope="col">NOMBRE_ITEMS_TIPOS</th>
                    <th scope="col">OBS_CALIDAD</th>
                    <th scope="col">ESTADO_CALIDAD</th>
                    <th scope="col">TIPO_VENTA</th>
                    <th scope="col">CODIGO_LATA</th>
                    <th scope="col">UNIDADES_CAJA</th>
                    <th scope="col">MES_INGRESO_BODEGA</th>
                    <th scope="col">AÃ‘O_INGRESO_BODEGA</th>
                    <th scope="col">NOMBRE_ITEMS_TIPO_ENVASE</th>
                    <th scope="col">RECIBIDO</th>
                    <th scope="col">STICKER</th>
                    <th scope="col">ETIQUETAS</th>
                    <th scope="col">CARTON</th>
                </thead>
                <tbody id="TablaAuto${TablaId}">
                </tbody>
            </table>
        </div>
    </div>`
}
async function GetValuesProducts(URI, CONFIG, PARAMS, INDEX, NOMBRE) {
        await TableAutogenerated(Filtros, INDEX, NOMBRE);
        let TablaAutogenerada = document.getElementById(`TablaAuto${INDEX}`);
        //let U = document.getElementById(`Unidades${INDEX}`);
        let S = document.getElementById(`Saldo${INDEX}`);
        let C = document.getElementById(`Cajas${INDEX}`);
        //let UD = document.getElementById(`UnidadesDes${INDEX}`);
        try {
            //console.log("Peticion 5 correcta");
            let datapure = await fetch(`${URI}/${PARAMS}`, CONFIG);
            //console.log("Peticion correcta4")
            datapure.json().then((data)=>{
                data.forEach(async (element) => {
                    //console.log(element)
                    TablaAutogenerada.innerHTML += ` 
                            <tr>
                            <td> ${element.num_guia}</td>
                            <td> ${element.nombre_items}</td>
                            <td> ${element.unidades}</td>
                            <td> ${element.unidades_despachadas}</td>
                            <td> ${element.saldo}</td>
                            <td> ${element.cajas}</td>
                            <td> ${element.fecha_guia}</td>
                            <td> ${element.obs_guia}</td>
                            <td> ${element.observaciones}</td>
                            <td> ${element.numero}</td>
                            <td> ${element.CodigoErp}</td>
                            <td> ${element.codigo}</td>
                            <td> ${element.nombredoc}</td>
                            <td> ${element.nombre_especie}</td>
                            <td> ${element.fecha_produccion}</td>
                            <td> ${element.Nombre_Items_Tipos}</td>
                            <td> ${element.Obs_Calidad}</td>
                            <td> ${element.estado_calidad}</td>
                            <td> ${element.tipo_venta}</td>                            
                            <td> ${element.codigo_lata}</td>
                            <td> ${element.Unidades_Cajas}</td>
                            <td> ${element.Mes_Ingreso_Bodega}</td>
                            <td> ${element.Anio_Ingreso_Bodega}</td>
                            <td> ${element.Nombre_Items_Tipo_Envase}</td>
                            <td> ${element.Recibido}</td>
                            <td> ${element.Sticker}</td>
                            <td> ${element.Etiquetas}</td>
                            <td> ${element.Carton}</td>
                        </tr>`
                        let count = await fetch(`http://192.168.1.12:8080/GetCuentas/${element.nombre_items}`, CONFIGAPI);
                        count.json().then((datos1)=>{
                                datos1.forEach((element1)=>{
                                    C.innerHTML = `${element1.SUMATORIACAJAS}`
                                    S.innerHTML= `${element1.SALDOCUENTA}`
                                    //U.innerHTML = `${element1.UNIDADES}`
                                    //UD.innerHTML = `${element1.UNIDADESDES}`
                                })
                               
                            }).catch(mistake=>{console.log(mistake)});
               
                 });
            }).catch(error=>{console.log(error)});
        } catch (error) {
            console.log("we are a mistake with the table")
        }
}

async function RegistroTabla() {
    try {
       //console.log("Peticion realizada9")
        let fetchexecuted = await fetch("http://192.168.1.12:8080/AllProducts", CONFIGAPI);
        fetchexecuted.json()
        .then((data)=>{
            data.forEach(async (element, index)=>{
                await GetValuesProducts(`http://192.168.1.12:8080/StokProductobyroduct`, CONFIGAPI, element.nombre_items, index+1, element.nombre_items);
            })
        })
    } catch (error) {
        console.log(error.message)
    }
}

async function HiddeLoad() {
        let MainContent = document.getElementById("MainContent");
        let animacion = document.getElementById("animacion");
        animacion.style = "display:none";
        MainContent.style = "display:flex"
}

async function finalyfunction() {
        
    await RegistroTabla();
    await HiddeLoad();

}

finalyfunction();

    